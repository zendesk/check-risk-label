name: Check PR risk label
description: Ensure that the PR risk labels are available in the repo, and that exactly one of them is applied to this PR
branding:
  icon: code
  color: gray-dark
inputs:
  ensure_labels_defined:
    description: 'Ensure that the risk labels exist in this repository (strict/names-only/false)'
    required: false
    default: 'strict'
  github_token:
    description: 'GITHUB_TOKEN (not needed if ensure_labels_defined is false)'
    required: false
  ensure_pr_is_labelled:
    description: 'Ensure that the pull request has exactly 1 risk label (true/false)'
    required: false
    default: 'true'
  ensure_template_text_removed_text:
    description: 'Text to ensure is not present in the pull request description (skipped if empty)'
    required: false
    default: ''
  ensure_template_text_removed_message:
    description: 'Message to use if the ensure_template_text_removed text is found in the PR description'
    required: false
    default: 'The description "Risks" section still seems to be as per template. Please fill it in.'
  enforce_min_approvals:
    description: 'Enforce minimum approvals based on risk (true/false)'
    required: false
    default: 'false'
  min_approvals_none:
    description: 'Required approvals for risk:none'
    required: false
    default: '1'
  min_approvals_low:
    description: 'Required approvals for risk:low'
    required: false
    default: '1'
  min_approvals_medium:
    description: 'Required approvals for risk:medium'
    required: false
    default: '1'
  min_approvals_high:
    description: 'Required approvals for risk:high'
    required: false
    default: '2'
runs:
  using: 'composite'
  steps:
    - run: ${{ github.action_path }}/run.rb
      shell: bash
      env:
        ENSURE_LABELS_DEFINED: ${{ inputs.ensure_labels_defined }}
        GITHUB_TOKEN: ${{ inputs.github_token }}
        ENSURE_PR_IS_LABELLED: ${{ inputs.ensure_pr_is_labelled }}
        ENSURE_TEMPLATE_TEXT_REMOVED_TEXT: ${{ inputs.ensure_template_text_removed_text }}
        ENSURE_TEMPLATE_TEXT_REMOVED_MESSAGE: ${{ inputs.ensure_template_text_removed_message }}
        ENFORCE_MIN_APPROVALS: ${{ inputs.enforce_min_approvals }}
        MIN_APPROVALS_NONE: ${{ inputs.min_approvals_none }}
        MIN_APPROVALS_LOW: ${{ inputs.min_approvals_low }}
        MIN_APPROVALS_MEDIUM: ${{ inputs.min_approvals_medium }}
        MIN_APPROVALS_HIGH: ${{ inputs.min_approvals_high }}
